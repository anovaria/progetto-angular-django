<header class="app-header-bar">
  <div class="logo-container">
    <h1><img src="/images/LOGO-CIDAC.png" alt="logo"></h1>
  </div>

  <div class="user-badge" *ngIf="username$ | async as username">
    <mat-icon>person</mat-icon>
    <span>{{ username }}</span>
    <button mat-icon-button class="logout-btn" (click)="logout()">
      <mat-icon>logout</mat-icon>
    </button>
  </div>
</header>

<mat-sidenav-container class="layout">

  <!-- SIDEBAR -->
  <mat-sidenav #drawer [mode]="isMobile ? 'over' : 'side'" [(opened)]="opened"
    [class.collapsed]="isCollapsed && !isMobile" class="sidebar">

    <div class="sidebar-header">
      <div class="sidebar-title" *ngIf="!isCollapsed">Menu</div>
      <button mat-icon-button class="collapse-btn" (click)="toggleSidebar()">
        <mat-icon>{{ isCollapsed ? 'chevron_right' : 'chevron_left' }}</mat-icon>
      </button>
    </div>

    <mat-nav-list>
      <ng-container *ngIf="groups$ | async as groups">

        <!-- PLU - Vendita + Admin -->
        <a mat-list-item *ngIf="hasGroup(groups, ['Freschi'])" [routerLink]="['/plu']">
          <mat-icon>qr_code_scanner</mat-icon>
          <span *ngIf="!isCollapsed">Plu</span>
        </a>

        <!-- Rossetto - Solo Admin -->
        <a mat-list-item *ngIf="isAdmin(groups)" routerLink="/django/importelab">
          <mat-icon>sync</mat-icon>
          <span *ngIf="!isCollapsed">Rossetto</span>
        </a>

        <!-- PALLET-PROMOTER - Menu espandibile -->
        <ng-container *ngIf="hasGroup(groups, ['pallet_manager', 'Ufficio Qualita', 'commerciale'])">
          <a mat-list-item (click)="togglePalletMenu()" class="menu-parent">
            <mat-icon>inventory_2</mat-icon>
            <span *ngIf="!isCollapsed">Pallet-Promoter</span>
            <mat-icon *ngIf="!isCollapsed" class="expand-icon">
              {{ palletExpanded ? 'expand_less' : 'expand_more' }}
            </mat-icon>
          </a>
          <div class="submenu" *ngIf="palletExpanded && !isCollapsed">
            <a mat-list-item routerLink="/django/pallet-promoter" routerLinkActive="active"
              [routerLinkActiveOptions]="{exact: true}">
              <mat-icon>dashboard</mat-icon>
              <span>Dashboard</span>
            </a>
            <a mat-list-item routerLink="/django/pallet-promoter-pallet" routerLinkActive="active">
              <mat-icon>grid_view</mat-icon>
              <span>Gestione Pallet</span>
            </a>
            <a mat-list-item routerLink="/django/pallet-promoter-testate" routerLinkActive="active">
              <mat-icon>view_column</mat-icon>
              <span>Gestione Testate</span>
            </a>
            <a mat-list-item routerLink="/django/pallet-promoter-hostess" routerLinkActive="active">
              <mat-icon>people</mat-icon>
              <span>Individuazione Hostess</span>
            </a>
            <a mat-list-item routerLink="/django/pallet-promoter-scelta-fornitore" routerLinkActive="active">
              <mat-icon>grid_on</mat-icon>
              <span>Scelta Fornitore</span>
            </a>
            <a mat-list-item routerLink="/django/pallet-promoter-presenze" routerLinkActive="active">
              <mat-icon>schedule</mat-icon>
              <span>Presenze</span>
            </a>
          </div>
        </ng-container>

        <!-- MERCHANDISER - Menu espandibile -->
        <ng-container *ngIf="hasGroup(groups, ['merchandiser_manager', 'Ufficio Qualita'])">
          <a mat-list-item (click)="toggleMerchandiserMenu()" class="menu-parent">
            <mat-icon>store</mat-icon>
            <span *ngIf="!isCollapsed">Merchandiser</span>
            <mat-icon *ngIf="!isCollapsed" class="expand-icon">
              {{ merchandiserExpanded ? 'expand_less' : 'expand_more' }}
            </mat-icon>
          </a>
          <div class="submenu" *ngIf="merchandiserExpanded && !isCollapsed">
            <a mat-list-item routerLink="/django/merchandiser" routerLinkActive="active"
              [routerLinkActiveOptions]="{exact: true}">
              <mat-icon>dashboard</mat-icon>
              <span>Dashboard</span>
            </a>
            <a mat-list-item routerLink="/django/merchandiser-slot" routerLinkActive="active">
              <mat-icon>event_available</mat-icon>
              <span>Gestione Slot</span>
            </a>
            <a mat-list-item routerLink="/django/merchandiser-anagrafiche" routerLinkActive="active">
              <mat-icon>people</mat-icon>
              <span>Anagrafiche Merchandiser</span>
            </a>
            <a mat-list-item routerLink="/django/merchandiser-hostess" routerLinkActive="active">
              <mat-icon>people</mat-icon>
              <span>Anagrafica Hostess</span>
            </a>
            <a mat-list-item routerLink="/django/merchandiser-attivita" routerLinkActive="active">
              <mat-icon>assignment</mat-icon>
              <span>Gestione Attività</span>
            </a>
          </div>
        </ng-container>

        <!-- ALLOCA HOSTESS - Menu espandibile -->
        <ng-container *ngIf="hasGroup(groups, ['centralino', 'Ufficio Qualita'])">
          <a mat-list-item (click)="toggleAllocaMenu()" class="menu-parent">
            <mat-icon>people</mat-icon>
            <span *ngIf="!isCollapsed">Hostess</span>
            <mat-icon *ngIf="!isCollapsed" class="expand-icon">
              {{ allocaExpanded ? 'expand_less' : 'expand_more' }}
            </mat-icon>
          </a>
          <div class="submenu" *ngIf="allocaExpanded && !isCollapsed">
            <a mat-list-item routerLink="/django/alloca-hostess" routerLinkActive="active"
              [routerLinkActiveOptions]="{exact: true}">
              <mat-icon>dashboard</mat-icon>
              <span>Dashboard</span>
            </a>
            <a mat-list-item routerLink="/django/alloca-hostess-individuazione" routerLinkActive="active">
              <mat-icon>person_search</mat-icon>
              <span>Gestione Slot</span>
            </a>
            <a mat-list-item routerLink="/django/alloca-hostess-hostess" routerLinkActive="active">
              <mat-icon>badge</mat-icon>
              <span>Lista Hostess</span>
            </a>
          </div>
        </ng-container>

        <!-- Punto Info - Admin + Punto Info -->
        <a mat-list-item *ngIf="hasGroup(groups, ['punto info', 'Ufficio Qualita'])" routerLink="/django/punto-info">
          <mat-icon>schedule</mat-icon>
          <span *ngIf="!isCollapsed">Registrazione Orari</span>
        </a>

        <!-- WELFARE - Menu espandibile -->
        <ng-container *ngIf="hasGroup(groups, ['ufficio cassa'])">
          <a mat-list-item (click)="toggleWelfareMenu()" class="menu-parent">
            <mat-icon>card_giftcard</mat-icon>
            <span *ngIf="!isCollapsed">Welfare</span>
            <mat-icon *ngIf="!isCollapsed" class="expand-icon">
              {{ welfareExpanded ? 'expand_less' : 'expand_more' }}
            </mat-icon>
          </a>
          <div class="submenu" *ngIf="welfareExpanded && !isCollapsed">
            <a mat-list-item routerLink="/django/welfare" routerLinkActive="active"
              [routerLinkActiveOptions]="{exact: true}">
              <mat-icon>dashboard</mat-icon>
              <span>Dashboard</span>
            </a>
            <a mat-list-item routerLink="/django/welfare-ricerca" routerLinkActive="active">
              <mat-icon>search</mat-icon>
              <span>Ricerca Voucher</span>
            </a>
            <a mat-list-item routerLink="/django/welfare-cassa" routerLinkActive="active">
              <mat-icon>point_of_sale</mat-icon>
              <span>Cassa</span>
            </a>
            <a mat-list-item routerLink="/django/welfare-consegne" routerLinkActive="active">
              <mat-icon>inventory</mat-icon>
              <span>Da Consegnare</span>
            </a>
            <a mat-list-item routerLink="/django/welfare-contabilita" routerLinkActive="active">
              <mat-icon>analytics</mat-icon>
              <span>Contabilità</span>
            </a>
            <a mat-list-item routerLink="/django/welfare-import" routerLinkActive="active">
              <mat-icon>email</mat-icon>
              <span>Import Email</span>
            </a>
          </div>
        </ng-container>

        <!-- Assoarticoli -->
        <a mat-list-item *ngIf="hasGroup(groups, ['GruppoCED'])" routerLink="/django/assortimenti">
          <mat-icon>inventory_2</mat-icon>
          <span *ngIf="!isCollapsed">AssoArticoli</span>
        </a>

        <!-- Django Admin - Solo Admin -->
        <a mat-list-item *ngIf="isAdmin(groups)" href="#" (click)="goToDjangoAdmin($event)">
          <mat-icon>admin_panel_settings</mat-icon>
          <span *ngIf="!isCollapsed">Django Admin</span>
        </a>

      </ng-container>
    </mat-nav-list>

  </mat-sidenav>

  <!-- CONTENT -->
  <mat-sidenav-content class="main-content-bg">
    <div class="main-content">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>